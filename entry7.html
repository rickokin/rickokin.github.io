<!DOCTYPE html>
<html>
  <head>
    <title>Google Maps with Map ID</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDAFyXLqb4z8kE1HehX-OKdH0hNjGyrLHI&libraries=places&callback=initMap" async defer></script>
    <script>
      var map;
      var marker;

      function initMap() {
        var mapId = '8ed753a23da1aad8'; // Your valid Map ID

        var defaultLocation = { lat: -34.397, lng: 150.644 }; // Default location
        map = new google.maps.Map(document.getElementById("map"), {
          center: defaultLocation,
          zoom: 6,
          mapId: mapId
        });

        // Get user's current location
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function (position) {
            var userLocation = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };

            // Set default values in the input boxes
            document.getElementById('manual-lat').value = userLocation.lat;
            document.getElementById('manual-lng').value = userLocation.lng;

            // Update map with user's location
            updateMap(userLocation.lat, userLocation.lng);
          });
        } else {
          alert("Geolocation is not supported by this browser.");
        }
      }

      function updateMap(lat, lng) {
        var location = { lat: parseFloat(lat), lng: parseFloat(lng) };
        map.setCenter(location);
        map.setZoom(15);

        if (marker) marker.setMap(null); // Remove old marker

        marker = new google.maps.Marker({
          position: location,
          map: map,
          title: "You are here"
        });

        document.getElementById("location-coordinates").innerHTML =
          "Latitude: " + lat + "<br>Longitude: " + lng;

        getAddressAndPlaceName(lat, lng);
        findNearbyPlaces(location);
      }

      function getAddressAndPlaceName(lat, lng) {
        var geocoder = new google.maps.Geocoder();
        var latlng = { lat: parseFloat(lat), lng: parseFloat(lng) };

        geocoder.geocode({ location: latlng }, function (results, status) {
          if (status === "OK") {
            if (results[0]) {
              document.getElementById("location-address").innerHTML =
                "Address: " + results[0].formatted_address;
            } else {
              document.getElementById("location-address").innerHTML = "No address found.";
            }
          } else {
            document.getElementById("location-address").innerHTML =
              "Geocoder failed due to: " + status;
          }
        });
      }

      function findNearbyPlaces(location) {
        var request = {
          location: location,
          radius: 1500,
          type: ['restaurant']
        };

        var service = new google.maps.places.PlacesService(map);
        service.nearbySearch(request, function (results, status) {
          if (status === google.maps.places.PlacesServiceStatus.OK) {
            document.getElementById("nearby-places").innerHTML = "";
            for (var i = 0; i < results.length; i++) {
              var place = results[i];
              var placeElement = document.createElement("li");
              placeElement.innerHTML = place.name + " - " + place.vicinity;
              document.getElementById("nearby-places").appendChild(placeElement);
            }
          }
        });
      }

      function manualLocationUpdate() {
        var lat = document.getElementById("manual-lat").value;
        var lng = document.getElementById("manual-lng").value;
        updateMap(lat, lng);
      }
    </script>
    <style>
      #map {
        height: 400px;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <h1>Google Maps with Map ID</h1>
    <div id="map"></div>

    <h3>Your Coordinates:</h3>
    <p id="location-coordinates">Waiting for location...</p>
    <h3>Your Address:</h3>
    <p id="location-address">Waiting for address...</p>

    <h3>Nearby Places:</h3>
    <ul id="nearby-places">
      <li>Loading nearby places...</li>
    </ul>

    <h3>Manual Latitude, Longitude:</h3>
    <input type="text" id="manual-lat" placeholder="Enter Latitude" />
    <input type="text" id="manual-lng" placeholder="Enter Longitude" />

    <button onclick="manualLocationUpdate()">Update Location</button>
  </body>
</html>
