<!DOCTYPE html>
<html>
  <head>
    <title>Find Place Details by Latitude and LongitudeXX</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDAFyXLqb4z8kE1HehX-OKdH0hNjGyrLHI&libraries=places&callback=initMap" async defer></script>
    <script>
      var geocoder;
      var map;
      var service;

      function initMap() {
        geocoder = new google.maps.Geocoder();
        map = new google.maps.Map(document.createElement('div')); // Map object needed for PlacesService
      }

      // Get location details (Place ID, name, address, types) based on lat/lng
      function getLocationDetails(lat, lng) {
        var latlng = { lat: parseFloat(lat), lng: parseFloat(lng) };

        // Geocode the lat/lng to get the address
        geocoder.geocode({ location: latlng }, function (results, status) {
          if (status === 'OK') {
            if (results[0]) {
              displayLocationInfo(results[0]);
            } else {
              alert('No results found.');
            }
          } else {
            alert('Geocoder failed due to: ' + status);
          }
        });

        // Use PlacesService to get Place ID and details
        getPlaceDetails(latlng);
      }

      // Get Place ID and details (name, address, place types) using PlacesService
      function getPlaceDetails(latlng) {
        service = new google.maps.places.PlacesService(map);
        var request = {
          location: latlng,
          radius: '10', // Small radius to get the specific place at the coordinates
        };

        service.nearbySearch(request, function (results, status) {
          if (status === google.maps.places.PlacesServiceStatus.OK && results.length > 0) {
            var place = results[0];
            displayPlaceDetails(place);
          } else {
            document.getElementById('place-id').innerText = 'No Place ID found for this location.';
          }
        });
      }

      // Display address info
      function displayLocationInfo(location) {
        document.getElementById('location-address').innerText = location.formatted_address;
      }

      // Display place details (Place ID, name, types)
      function displayPlaceDetails(place) {
        document.getElementById('place-id').innerText = place.place_id;
        document.getElementById('place-name').innerText = place.name;
        document.getElementById('place-types').innerText = place.types ? place.types.join(', ') : 'No types available';
      }

      // Handle form submission to update latitude/longitude
      function manualLocationUpdate(e) {
        e.preventDefault();
        var lat = document.getElementById('manual-lat').value;
        var lng = document.getElementById('manual-lng').value;
        getLocationDetails(lat, lng);
      }
    </script>
    <style>
      #location-info {
        margin-top: 20px;
      }
      label {
        display: block;
        margin-top: 10px;
      }
      #location-details p {
        margin: 5px 0;
      }
    </style>
  </head>
  <body>
    <h1>Find Place Details by Latitude and Longitude</h1>

    <form onsubmit="manualLocationUpdate(event)">
      <label for="manual-lat">Latitude:</label>
      <input type="text" id="manual-lat" placeholder="Enter Latitude" required/>

      <label for="manual-lng">Longitude:</label>
      <input type="text" id="manual-lng" placeholder="Enter Longitude" required/>

      <button type="submit">Find Place</button>
    </form>

    <div id="location-info">
      <h3>Location Details</h3>
      <div id="location-details">
        <p><strong>Address:</strong> <span id="location-address">Waiting for location...</span></p>
        <p><strong>Place ID:</strong> <span id="place-id">Waiting for Place ID...</span></p>
        <p><strong>Place Name:</strong> <span id="place-name">Waiting for Place Name...</span></p>
        <p><strong>Place Types:</strong> <span id="place-types">Waiting for Place Types...</span></p>
      </div>
    </div>

    <script>
      window.onload = initMap;
    </script>
  </body>
</html>
