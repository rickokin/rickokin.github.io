<!DOCTYPE html>
<html>
  <head>
    <title>Location Finder with Place Details</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDAFyXLqb4z8kE1HehX-OKdH0hNjGyrLHI&libraries=places&callback=initMap" async defer></script>
    <script>
      var geocoder;
      var map;
      var service;
      var currentLocation = { lat: 0, lng: 0 };

      function initMap() {
        geocoder = new google.maps.Geocoder();
        map = new google.maps.Map(document.createElement('div')); // We need a map object for the PlacesService

        // Try to get the user's current location
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            function (position) {
              currentLocation = {
                lat: position.coords.latitude,
                lng: position.coords.longitude,
              };
              document.getElementById('manual-lat').value = currentLocation.lat;
              document.getElementById('manual-lng').value = currentLocation.lng;
              getLocationDetails(currentLocation.lat, currentLocation.lng);
            },
            function () {
              alert('Geolocation failed. Please enter coordinates manually.');
            }
          );
        } else {
          alert('Geolocation is not supported by this browser.');
        }
      }

      function getLocationDetails(lat, lng) {
        var latlng = { lat: parseFloat(lat), lng: parseFloat(lng) };

        geocoder.geocode({ location: latlng }, function (results, status) {
          if (status === 'OK') {
            if (results[0]) {
              displayLocationInfo(results[0]);
            } else {
              alert('No results found.');
            }
          } else {
            alert('Geocoder failed due to: ' + status);
          }
        });

        getPlaceDetails(latlng);
      }

      function getPlaceDetails(latlng) {
        service = new google.maps.places.PlacesService(map);
        var request = {
          location: latlng,
          radius: '10', // Small radius to get the place details of the given location
        };

        service.nearbySearch(request, function (results, status) {
          if (status === google.maps.places.PlacesServiceStatus.OK && results.length > 0) {
            var placeId = results[0].place_id;

            // Get more detailed information about the place using its Place ID
            var requestDetails = {
              placeId: placeId,
              fields: ['name', 'formatted_address', 'types', 'rating', 'opening_hours', 'website'],
            };

            service.getDetails(requestDetails, function (place, status) {
              if (status === google.maps.places.PlacesServiceStatus.OK) {
                displayPlaceDetails(place);
              }
            });
          }
        });
      }

      function displayLocationInfo(location) {
        document.getElementById('location-address').innerText = location.formatted_address;
      }

      function displayPlaceDetails(place) {
        document.getElementById('location-name').innerText = place.name || 'N/A';
        document.getElementById('location-type').innerText = place.types ? place.types.join(', ') : 'N/A';
        document.getElementById('location-rating').innerText = place.rating ? place.rating + ' / 5' : 'No rating';
        document.getElementById('location-hours').innerText = place.opening_hours
          ? place.opening_hours.weekday_text.join(', ')
          : 'No opening hours available';
        document.getElementById('location-website').innerHTML = place.website
          ? `<a href="${place.website}" target="_blank">${place.website}</a>`
          : 'No website available';
      }

      function manualLocationUpdate(e) {
        e.preventDefault();
        var lat = document.getElementById('manual-lat').value;
        var lng = document.getElementById('manual-lng').value;
        getLocationDetails(lat, lng);
      }
    </script>
    <style>
      #location-info {
        margin-top: 20px;
      }
      label {
        display: block;
        margin-top: 10px;
      }
      #location-details p {
        margin: 5px 0;
      }
    </style>
  </head>
  <body>
    <h1>Location Finder with Place Details</h1>

    <form onsubmit="manualLocationUpdate(event)">
      <label for="manual-lat">Latitude:</label>
      <input type="text" id="manual-lat" placeholder="Enter Latitude" />

      <label for="manual-lng">Longitude:</label>
      <input type="text" id="manual-lng" placeholder="Enter Longitude" />

      <button type="submit">Update Location</button>
    </form>

    <div id="location-info">
      <h3>Location Details</h3>
      <div id="location-details">
        <p><strong>Address:</strong> <span id="location-address">Waiting for location...</span></p>
        <p><strong>Name:</strong> <span id="location-name">Waiting for place details...</span></p>
        <p><strong>Place Type:</strong> <span id="location-type">Waiting for place details...</span></p>
        <p><strong>Rating:</strong> <span id="location-rating">Waiting for rating...</span></p>
        <p><strong>Opening Hours:</strong> <span id="location-hours">Waiting for hours...</span></p>
        <p><strong>Website:</strong> <span id="location-website">Waiting for website...</span></p>
      </div>
    </div>

    <script>
      window.onload = initMap;
    </script>
  </body>
</html>
